<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jmh.mapper.BoardMapper">
	
	<!--  데이터베이스의 컬럼과 VO가 다를때-->
	<!-- <RESULTMAP TYPE="COM.JMH.VO.BOARDVO" ID="BOARDVO">
    	<RESULT PROPERTY="BOARDTYPE" 	COLUMN="BOARD_TYPE"/>
    	<RESULT PROPERTY="BOARDNUM" 	COLUMN="BOARD_NUM"/>
    	<RESULT PROPERTY="BOARDTITLE" 	COLUMN="BOARD_TITLE"/>
    	<RESULT PROPERTY="BOARDCOMMENT" COLUMN="BOARD_COMMENT"/>
    </RESULTMAP> -->
	
	<select id="getBoardList" resultType="com.jmh.vo.BoardVO"><!-- <![CDATA[]]> -->
		<!-- SELECT * FROM BOARD WHERE BNO > 0 -->
		<![CDATA[
		SELECT 
		 BNO
		  ,BTYPE
		  ,BTITLE
		  ,BCONTENT
		FROM 
		(
		   SELECT
		      	BNO
				,BTYPE
				,BTITLE
				,BCONTENT
		      	,ROW_NUMBER() OVER(ORDER BY BNO DESC) AS NUMROW
		      	,COUNT(*) OVER() AS TOTAL_CNT
			FROM
				(
					SELECT
						BNO
						,BTYPE
						,BTITLE
						,BCONTENT
					FROM
						BOARD
					WHERE
						BNO > 0
		]]>
					<!-- <include refid="criteria"></include> -->
		<choose>
			<when test="searchField == 'title'">
				and BTitle like '%'||#{searchWord}||'%'
			</when>
			<when test="searchField == 'content'">
				and BContent like '%'||#{searchWord}||'%'
			</when>
			<when test="searchField == 'writer'">
				and BTYPE like '%'||#{searchWord}||'%'
			</when>
		</choose>
					
				)
		)
		WHERE 
			NUMROW BETWEEN #{startNo} AND #{endNo}
	</select>
	
	<delete id="delete" parameterType="integer">
		DELETE 
		FROM 
			BOARD
		WHERE 
			BNO = #{checkNum}
	</delete>
	
	<insert id="insertB" parameterType="com.jmh.vo.BoardVO">
		INSERT 
		INTO 
			BOARD
			(
				BNO
				,BTYPE
				,BTITLE
				,BCONTENT) 
		VALUES 
		(
			(
				SELECT 
		  			TO_NUMBER(NVL(MAX(BNO), 0))+ 1 
		  		FROM 
		  			BOARD
		  	)
		  		,#{BType}
		  		,#{BTitle}
		  		,#{BContent}
		 )
	</insert>
	
	<select id="getModifyList" resultType="com.jmh.vo.BoardVO" parameterType="integer">
		SELECT 
			* 
		FROM 
			BOARD
		WHERE 
			BNO = #{BNO}
	</select>
	
	<update id="modifyB" parameterType="com.jmh.vo.BoardVO">
		UPDATE 
			BOARD 
		SET 
			BTYPE = #{BType}
			,BTITLE = #{BTitle}
			,BCONTENT = #{BContent} 
		WHERE 
			BNO = #{BNO}
	</update>
	
	<select id="getTotalCnt" resultType="integer"  parameterType="integer">
		SELECT 
			COUNT(*) 
		FROM 
			BOARD
	</select>
	
	<sql id="criteria">
		<choose>
			<when test="searchField == 'title'">
				and BTitle like '%'||#{searchWord}||'%'
			</when>
			<when test="searchField == 'content'">
				and BContent like '%'||#{searchWord}||'%'
			</when>
			<when test="searchField == 'writer'">
				and BTYPE like '%'||#{searchWord}||'%'
			</when>
		</choose>
	</sql>
</mapper>  
